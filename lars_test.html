<!DOCTYPE html>
<meta charset="utf-8">
<style>
    /* set the CSS */

    body {
        font: 12px Arial;
    }

    path {
        stroke: steelblue;
        stroke-width: 2;
        fill: none;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: grey;
        stroke-width: 1;
        shape-rendering: crispEdges;
    }
</style>

<body>

    <div id="option">
        <input name="updateButton" type="button" value="Update" onclick="updateData()" />
    </div>

    <!-- load the d3.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>

    <script>

        var cgm = {
            "12:02:52": 104.0,
            "12:07:52": 104.0, "12:12:51": 103.0, "12:17:52": 103.0, "12:22:51": 103.0,
            "12:27:51": 103.0, "12:32:51": 101.0, "12:37:52": 100.0, "12:42:51": 101.0, 
            "12:47:52": 101.0, "12:52:51": 102.0, "12:57:51": 102.0, "13:02:50": 102.0, 
            "13:07:50": 102.0, "13:12:51": 101.0, "13:17:51": 100.0, "13:22:51": 100.0, 
            "13:27:51": 101.0, "13:32:51": 100.0, "13:37:51": 100.0, "13:42:51": 101.0, 
            "13:47:50": 101.0, "13:52:50": 100.0, "13:57:52": 98.0, "14:02:51": 100.0, 
            "14:07:51": 101.0, "14:12:51": 99.0, "14:17:51": 91.0, "14:22:52": 90.0, 
            "14:27:51": 95.0, "14:32:52": 94.0, "14:37:51": 93.0, "14:42:51": 96.0, 
            "14:47:51": 95.0, "14:52:51": 96.0, "14:57:52": 97.0, "15:02:51": 97.0, 
            "15:07:50": 97.0, "15:12:50": 97.0, "15:17:50": 94.0, "15:22:50": 92.0,
            "15:27:50": 93.0, "15:32:51": 94.0, "15:37:51": 93.0, "15:42:50": 92.0, 
            "15:47:50": 91.0, "15:52:50": 90.0, "15:57:50": 89.0, "16:02:50": 90.0, 
            "16:07:51": 92.0, "16:12:49": 95.0, "16:17:50": 98.0, "16:22:50": 101.0, 
            "16:27:50": 102.0, "16:32:49": 106.0, "16:37:50": 109.0, "16:42:51": 111.0, 
            "16:47:51": 114.0, "16:52:50": 114.0, "16:57:51": 115.0, "17:02:50": 118.0, 
            "17:07:50": 117.0, "17:12:50": 118.0, "17:17:50": 128.0, "17:22:51": 132.0, 
            "17:27:50": 133.0, "17:32:50": 133.0, "17:37:50": 136.0, "17:42:50": 140.0, 
            "17:47:50": 141.0, "17:52:51": 144.0, "17:57:51": 151.0, "18:02:50": 156.0, 
            "18:07:50": 164.0, "18:12:50": 168.0, "18:17:51": 173.0, "18:22:51": 181.0, 
            "18:27:51": 188.0, "18:32:51": 198.0, "18:37:51": 205.0, "18:42:51": 209.0, 
            "18:47:50": 212.0, "18:52:50": 210.0, "18:57:51": 213.0, "19:02:50": 216.0, 
            "19:07:51": 222.0, "19:12:50": 222.0, "19:17:51": 224.0, "19:22:51": 223.0, 
            "19:27:51": 229.0, "19:32:51": 230.0, "19:37:50": 226.0, "19:42:49": 223.0, 
            "19:47:50": 229.0, "19:52:50": 225.0, "19:57:50": 230.0, "20:02:49": 235.0, 
            "20:07:50": 235.0, "20:12:50": 235.0, "20:17:49": 238.0, "20:22:50": 230.0, 
            "20:27:50": 228.0, "20:32:49": 237.0, "20:37:49": 239.0, "20:42:50": 238.0, 
            "20:47:50": 235.0, "20:52:49": 231.0, "20:57:50": 225.0, "21:02:50": 226.0, 
            "21:07:50": 218.0, "21:12:50": 210.0, "21:17:50": 218.0, "21:22:50": 208.0, 
            "21:27:50": 201.0, "21:32:50": 198.0, "21:37:50": 199.0, "21:42:50": 190.0, 
            "21:47:50": 187.0, "21:52:49": 181.0, "21:57:50": 182.0, "22:02:50": 180.0, 
            "22:07:50": 178.0, "22:12:50": 179.0, "22:17:49": 177.0, "22:22:50": 174.0, 
            "22:27:50": 169.0, "22:32:50": 166.0, "22:37:50": 161.0, "22:42:50": 161.0, 
            "22:47:50": 158.0, "22:52:49": 156.0, "22:57:50": 154.0, "23:02:50": 151.0, 
            "23:07:50": 147.0, "23:12:50": 147.0, "23:17:50": 146.0, "23:22:50": 140.0, 
            "23:27:50": 136.0, "23:32:50": 135.0, "23:37:50": 133.0, "23:42:50": 128.0, 
            "23:47:50": 124.0, "23:52:50": 120.0, "23:57:50": 119.0
        }

        // Set the dimensions of the canvas / graph
        var margin = { top: 30, right: 20, bottom: 30, left: 50 },
            width = 600 - margin.left - margin.right,
            height = 270 - margin.top - margin.bottom;

        // Parse the date / time
        var parseTime = d3.time.format("%h:%m:%s").parse;

        // Set the ranges
        var x = d3.time.scale().range([0, width]);
        var y = d3.scale.linear().range([height, 0]);

        // Define the axes
        var xAxis = d3.svg.axis().scale(x)
            .orient("bottom").ticks(5);

        var yAxis = d3.svg.axis().scale(y)
            .orient("left").ticks(5);

        // Define the line
        var valueline = d3.svg.line()
            .x(function (d) { return x(d.time); })
            .y(function (d) { return y(d.sgv); });

        // Adds the svg canvas
        var svg = d3.select("body")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        // Get the data
        data={}
        data["time"] = Object.keys(cgm);
        data["sgv"]=Object.values(cgm);


        // Scale the range of the data
        x.domain(d3.extent(data, function (d) { return d.time; }));
        y.domain([0, d3.max(data, function (d) { return d.sgv; })]);

        // Add the valueline path.
        svg.append("path")
            .attr("class", "line")
            .attr("d", valueline(data));

        // Add the X Axis
        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);

        // Add the Y Axis
        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis);



        // ** Update data section (Called from the onclick)
        function updateData() {

            // Get the data again
            d3.csv("data-alt.csv", function (error, data) {
                data.forEach(function (d) {
                    d.date = parseDate(d.date);
                    d.close = +d.close;
                });

                // Scale the range of the data again 
                x.domain(d3.extent(data, function (d) { return d.date; }));
                y.domain([0, d3.max(data, function (d) { return d.close; })]);

                // Select the section we want to apply our changes to
                var svg = d3.select("body").transition();

                // Make the changes
                svg.select(".line")   // change the line
                    .duration(750)
                    .attr("d", valueline(data));
                svg.select(".x.axis") // change the x axis
                    .duration(750)
                    .call(xAxis);
                svg.select(".y.axis") // change the y axis
                    .duration(750)
                    .call(yAxis);

            });
        }

    </script>
</body>