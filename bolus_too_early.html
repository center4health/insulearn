<!DOCTYPE html>
<html lang="en">
<head>
  <title>Diabetes Educational Tool</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<style>

  .popup {
    display: none;
    background-color: white;
    position: absolute;
    top: 320px;
    z-index: 0.5;
    width: 25%;
    left: 37%;
    border-style: solid;
    border-width: 10px;
    border-top: hidden;
    border-right: hidden;
    border-left: hidden;
    -webkit-box-shadow: 2px 2px 10px 0px rgba(209,209,209,1);
    -moz-box-shadow: 2px 2px 10px 0px rgba(209,209,209,1);
    -o-box-shadow: 2px 2px 10px 0px rgba(209,209,209,1);
    box-shadow: 2px 2px 10px 0px rgba(209,209,209,1);
    border-radius: 5px;
    padding: 20px;
  }

  .example-open .modal-backdrop {
     background-color: black; /* adds overlay to beginning pop-up */
  }

  .modal-backdrop {
     background-color: transparent; /* removes overlay from popup */
  }

  .modal-content{ /* shadow for the modal */
    -webkit-box-shadow: 2px 2px 10px 0px rgba(209,209,209,1);
    -moz-box-shadow: 2px 2px 10px 0px rgba(209,209,209,1);
    -o-box-shadow: 2px 2px 10px 0px rgba(209,209,209,1);
    box-shadow: 2px 2px 10px 0px rgba(209,209,209,1);
    border: white 0px;
  }

  #target {
    position: absolute;
    width: 300px;
    top: 615px;
    left: 765px;
    z-index: 10;
    border-bottom: hidden;
  }

  #intro, #scenario {
    position: absolute;
    top: 25%
  }

  /* #reset {
    position: absolute;
    top: 250px;
    right: 350px;
  } */

  .tooltip-inner {
    background-color: white;
    font-family: 'Montserrat', sans-serif;
    color: black;
    font-size: 16px;
    padding: 20px;
    -webkit-box-shadow: 2px 2px 10px 0px rgba(209,209,209,1);
    -moz-box-shadow: 2px 2px 10px 0px rgba(209,209,209,1);
    -o-box-shadow: 2px 2px 10px 0px rgba(209,209,209,1);
    box-shadow: 2px 2px 10px 0px rgba(209,209,209,1);
    border: white 0px;
    max-width: 300px;
    text-align: left;
  }

  .tooltip.in {
      opacity: 1; /* solid background for tooltip */
  }

  #timeNum {
    font-size: 24px;
    color: #41948E;
  }

  #bolus_meal_time {
    font-size: 12px;
    margin-top: -15px;
    margin-bottom: -5px;
    padding-left: 125px;
    margin-left: -100px;
    margin-right: -100px;
  }
</style>
<body>

  <!--Fixed Navigation Bar-->
  <nav class="navbar navbar-default navbar-fixed-top" id="header">
    <div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><b>Name of Site</b></a>
      </div>

      <!-- Links to home, interactive graphs, terminology, and about -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="index.html">Home</a></li>
          <li class="active"><a href="graphs-menu.html">Interactive Graphs</a></li>
          <li><a href="terminology.html">Learn More</a></li>
          <li><a href="about.html">About</a></li>
        </ul>
      </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
  </nav>

  <div class="container">
    <a href="graphs-menu.html" style="color: #9B9B9B"><img src="img/back_arrow.png" style= "width: 25px"> Back to Interactive Graphs Menu</a>

    <center>
      <div style="width: 750px">
        <h3 style="text-align: left"><b>Insulin Timing</b></h3>
        <p style="text-align: left">Choose a starting graph</p>
        <div style="text-align: left">
          <img src="img/bolus_early_current.png" width="100" data-toggle="tooltip" data-placement="bottom" data-container="body" data-html="true" title="<b>Scenario</b>: You pre-bolused for your meal, but recieved
            an important call before you started eating. You ended up eating an hour after you pre-bolused.">
          <a href="bolus_too_late.html"><img src="img/bolus_late.png" width="100" data-toggle="tooltip" data-placement="bottom" data-container="body" data-html="true" title="<b>Scenario</b>: You set a reminder to pre-bolus, but the
            alarm did not go off on time. You bolused later after the meal."></a>
          <button type="button" class="btn btn-primary" id="reset" style="margin-top: -50px; margin-left: 680px">Reset</button>
        </div>
        <p id="timeinrange" style="width:200px; margin-left: 570px" data-toggle="tooltip" data-placement="bottom" data-html="true" title="<p>The <b>time in range</b> is the percentage of time that your
          blood sugar levels are within a target range over a period of time.</p>">Time In Range: <b id="timeNum">95%</b></p>
        <svg width="750" height="525"></svg>
        <div class="row">
          <div class="col-sm-2"><p style="text-align: center"><b id="bolus" data-toggle="tooltip" data-placement="top" data-container="body" data-html="true" title="<p>A <b>bolus</b> is insulin you take when you eat to keep blood sugar
             levels controlled after meals. <br><br><b>Pre-bolusing</b> is when you take your
             insulin dose before you eat, usually 5-15 minutes before depending
             on the circumstances. </p>">Bolus</b></p></div>
          <div class="col-sm-10"></div>
        </div>
        <div class="row"> <!-- TIME SLIDER-->
          <div class="col-sm-2">
            <p id="selectedTime">Time (hr): 4:00 PM</p>
          </div>
          <div class="col-sm-10">
            <p id="bolus_meal_time">60 min before meal</p>
            <input type="range" name="bolus_time" id=bolus_time min="-150" max="100" value="0" style="width: 600px"></input>
          </div>
        </div>
      </div>
    </center>
  </div>

  <!-- Modal: Intro -->
  <div class="modal fade" id="intro" tabindex="-1" role="dialog" aria-labelledby="movingdown" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header" style="padding: 25px">
          <center><p style="font-size: 20px">Imagine that...</p></center>
          <p style="font-size: 20px">You pre-bolused for your meal, but recieved
            an important call before you started eating. You ended up eating an
            hour after you pre-bolused.</p><br>
          <p style="font-size: 20px">Adjust the <b>bolus time</b> to
             increase the time in range.<br>
          <center>
            <button type="button" id="back" class="btn back" style="margin-top: 10px">Back</button>
            <button type="button" id="next" class="btn btn-primary" style="margin-top: 10px">Next</button>
          </center>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Scenario -->
  <!-- <div class="modal fade" id="scenario" tabindex="-1" role="dialog" aria-labelledby="movingdown" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header" style="padding: 25px">
          <center><p style="font-size: 20px">Imagine that...</p></center>
          <p style="font-size: 20px">You pre-bolused for your meal, but recieved
            an important call before you started eating. You ended up eating an
            hour after you pre-bolused.</p><br>
          <center>
            <button type="button" class="btn btn-primary" data-dismiss="modal" aria-label="Close">Adjust Bolus</button>
          </center>
        </div>
      </div>
    </div>
  </div> -->

  <!-- Popup: Going Low -->
  <div class="popup" id="below70" style="display: block; border-color: #EB8690">
    <p style="font-size: 14px">The glucose levels are <b>below 70 mg/dL</b>.<br><br>Try
       adjusting the sliders to stay between the target range of 180 mg/dL and
       70mg/dL.</p>
  </div>

  <!-- Popup: Going High -->
  <div class="popup" id="above180" style="border-color: #FFB800">
    <p style="font-size: 14px">The glucose levels are <b>above 180 mg/dL</b>.<br><br>Try
       adjusting the sliders to stay between the target range of 180 mg/dL and
       70 mg/dL.</p>
  </div>

  <!-- Popup: Going Low & High -->
  <div class="popup" id="above_below" style="border-color: #FFA17A">
    <p style="font-size: 14px">The glucose levels are <b>below 70 mg/dL</b> and <b>above 180 mg/dL</b>.<br><br>Try
       adjusting the sliders to stay between the target range of 180mg/dL and
       70mg/dL.</p>
  </div>

  <!-- Popup: Target Range -->
  <div class="popup" id="target">
    <p>This <b>target range</b> (target blood sugar levels) is between 70 and
       180 mg/dl. This specific range is for example only.</p>
  </div>
</body>

<script src="https://d3js.org/d3.v5.min.js"></script>
<script>
    //let's get our data ready
    let show = 0;
    let selectVal = 0;
    let bg_raw = [["12:02:52", 104.0], ["12:07:52", 104.0], ["12:12:51", 103.0],
        ["12:17:52", 100.0], ["12:22:51", 100.0], ["12:27:51", 102.0],
        ["12:32:51", 103.0], ["12:37:52", 104.0], ["12:42:51", 106.0],
        ["12:47:52", 107.0], ["12:52:51", 108.0], ["12:57:51", 109.0],
        ["13:02:50", 110.0], ["13:07:50", 113.0], ["13:12:51", 114.0],
        ["13:17:51", 114.0], ["13:22:51", 114.0], ["13:27:51", 116.0],
        ["13:32:51", 117.0], ["13:37:51", 118.0], ["13:42:51", 118.0],
        ["13:47:50", 118.0], ["13:52:50", 119.0], ["13:57:52", 120.0],
        ["14:02:51", 120.0], ["14:07:51", 121.0], ["14:12:51", 123.0],
        ["14:17:51", 123.0], ["14:22:52", 123.0], ["14:27:51", 125.0],
        ["14:32:52", 124.0], ["14:37:51", 125.0], ["14:42:51", 124.0],
        ["14:47:51", 125.0], ["14:52:51", 123.0], ["14:57:52", 125.0],
        ["15:02:51", 126.0], ["15:07:50", 127.0], ["15:12:50", 125.0],
        ["15:17:50", 126.0], ["15:22:50", 128.0], ["15:27:50", 129.0],
        ["15:32:51", 130.0], ["15:37:51", 130.0], ["15:42:50", 130.0],
        ["15:47:50", 131.0], ["15:52:50", 130.0], ["15:57:50", 131.0],
        ["16:02:50", 131.0], ["16:07:51", 132.0], ["16:12:49", 131.0],
        ["16:17:50", 133.0], ["16:22:50", 132.0], ["16:27:50", 133.0],
        ["16:32:49", 133.0], ["16:37:50", 134.0], ["16:42:51", 133.0],
        ["16:47:51", 134.0], ["16:52:50", 135.0], ["16:57:51", 136.0],
        ["17:02:50", 140.0], ["17:07:50", 144.0], ["17:12:50", 148.0],
        ["17:17:50", 154.0], ["17:22:51", 161.0], ["17:27:50", 163.0],
        ["17:32:50", 165.0], ["17:37:50", 168.0], ["17:42:50", 170.0],
        ["17:47:50", 171.0], ["17:52:51", 177.0], ["17:57:51", 182.0],
        ["18:02:50", 183.0], ["18:07:50", 184.0], ["18:12:50", 189.0],
        ["18:17:51", 193.0], ["18:22:51", 196.0], ["18:27:51", 200.0],
        ["18:32:51", 208.0], ["18:37:51", 214.0], ["18:42:51", 223.0],
        ["18:47:50", 233.0], ["18:52:50", 240.0], ["18:57:51", 250.0],
        ["19:02:50", 260.0], ["19:07:51", 267.0], ["19:12:50", 270.0],
        ["19:17:51", 277.0], ["19:22:51", 285.0], ["19:27:51", 290.0],
        ["19:32:51", 295.0], ["19:37:50", 300.0], ["19:42:49", 305.0],
        ["19:47:50", 310.0], ["19:52:50", 315.0], ["19:57:50", 321.0],
        ["20:02:49", 325.0], ["20:07:50", 328.0], ["20:12:50", 329.0],
        ["20:17:49", 330.0], ["20:22:50", 331.0], ["20:27:50", 333.0],
        ["20:32:49", 335.0], ["20:37:49", 337.0], ["20:42:50", 338.0],
        ["20:47:50", 338.0], ["20:52:49", 338.0], ["20:57:50", 338.0],
        ["21:02:50", 338.0], ["21:07:50", 338.0], ["21:12:50", 338.0],
        ["21:17:50", 338.0], ["21:22:50", 338.0], ["21:27:50", 338.0],
        ["21:32:50", 338.0], ["21:37:50", 338.0], ["21:42:50", 338.0],
        ["21:47:50", 338.0], ["21:52:49", 338.0], ["21:57:50", 338.0],
        ["22:02:50", 338.0], ["22:07:50", 338.0], ["22:12:50", 338.0],
        ["22:17:49", 338.0], ["22:22:50", 338.0], ["22:27:50", 338.0],
        ["22:32:50", 338.0], ["22:37:50", 338.0], ["22:42:50", 338.0],
        ["22:47:50", 338.0], ["22:52:49", 338.0], ["22:57:50", 338.0],
        ["23:02:50", 338.0], ["23:07:50", 338.0], ["23:12:50", 338.0],
        ["23:17:50", 338.0], ["23:22:50", 338.0], ["23:27:50", 338.0],
        ["23:32:50", 338.0], ["23:37:50", 338.0], ["23:42:50", 338.0],
        ["23:47:50", 338.0], ["23:52:50", 338.0], ["23:57:50", 338.0]];
    let insulin = [[0, 0], [23, 30], [46, 80], [69, 95], [92, 100], [115, 90], [138, 50], [161, 35], [184, 20], [207, 15], [230, 10], [253, 5], [300, 0]]


    var timeParse = d3.timeParse("%H:%M:%S")
    bg_raw.forEach(d => {
        d[0] = timeParse(d[0]);
    })


    default_bolus_time = timeParse("16:00:00");
    offset = 0;
    var dose = 1.5;

    function calculate_insulin_curve(bolus = default_bolus_time) {
        var curve = [];
        insulin.forEach(d => {

            curve.push([d3.timeMinute.offset(bolus, d[0]), dose*d[1]])
        })
        return curve
    }
    insulin_curve = calculate_insulin_curve();

    //console.log(insulin_curve)

    var svg = d3.select("svg"),
        margin = { top: 20, right: 20, bottom: 30, left: 50 },
        width = +svg.attr("width") - margin.left - margin.right,
        height = +svg.attr("height") - margin.top - margin.bottom;


    function apply_insulin(insulin){
        //ugly way of copying an array
        var bg = bg_raw.map(function(arr) {
                return arr.slice();
            });

        k=0
        for (i = 0; i < bg.length; i++){

            if (bg[i][0]>insulin[0][0]){
                var old_change=bg_raw[i][1]-bg_raw[i-1][1];

                bg[i][1]=bg[i-1][1]+old_change

                if (Math.floor(k/5)<insulin.length){
                    bg[i][1]-=insulin[Math.floor(k/6)][1]/20;
                }
                k+=1
            }
        }
        return bg
    }

    var bg=apply_insulin(insulin_curve);

    var x = d3.scaleTime()
        .range([0, width]);

    var y = d3.scaleLinear().domain([0, 400])
        .rangeRound([height, 0]);

    var xAxis = d3.axisBottom(x),
        yAxis = d3.axisLeft(y);

    // var low_threshold = d3.line()
    //     .x(function(d) { return x(d[0]); })
    //     .y(return y(70); );

    var line = d3.line()
        .x(function (d) { return x(d[0]); })
        .y(function (d) { return y(d[1]); });

    let drag = d3.drag()
        .on('start', dragstarted)
        .on('drag', dragged)
        .on('end', dragended);

    svg.append('rect')
        .attr('class', 'zoom')
        .attr('cursor', 'move')
        .attr('fill', 'none')
        .attr('pointer-events', 'all')
        .attr('width', width)
        .attr('height', height)
        .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')

    // shade time in range section
    svg.append('rect')
        .style("fill", "#EFF6FE")
        .attr("x", 50)
        .attr("y", 280)
        .attr("width", 680)
        .attr("height", 130);

    //rough estimate of upper threshold
    svg.append('line')
        .style("stroke", "#FFB800") // color of upper threshold line
        .style("stroke-dasharray", ("3, 5"))
        .style("stroke-width", 2)
        .attr("x1", 50)
        .attr("y1", 280)
        .attr("x2", 720)
        .attr("y2", 280);

    //rough estimate of lower threshold
    svg.append('line')
        .style("stroke", "#EB8690") // color of lower threshold line
        .style("stroke-dasharray", ("3, 5"))
        .style("stroke-width", 2)
        .attr("x1", 50)
        .attr("y1", 410)
        .attr("x2", 720)
        .attr("y2", 410);

    //rough estimate of upper threshold
    svg.append('line')
        .style("stroke", "#FFB800") // color of upper threshold line
        .style("stroke-dasharray", ("3, 5"))
        .style("stroke-width", 2)
        .attr("x1", 50)
        .attr("y1", 280)
        .attr("x2", 720)
        .attr("y2", 280);

    // upper threshold label
    svg.append("text")
       .attr("y", 285)
       .attr("x", 735)
       .attr('text-anchor', 'middle')
       .attr("class", "range") // use to style in stylesheet
       .text("180");

    // lower threshold label
    svg.append("text")
        .attr("y", 415)
        .attr("x", 735)
        .attr('text-anchor', 'middle')
        .attr("class", "range") // use to style in stylesheet
        .text("70");

    // upper threshold label
    svg.append("text")
       .attr("y", 285)
       .attr("x", 735)
       .attr('text-anchor', 'middle')
       .attr("class", "range") // use to style in stylesheet
       .text("180");

    // glucose label
    svg.append("text")
        .attr("transform", "translate(12,340) rotate(-90)")
        .attr("class", "range") // use to style in stylesheet
        .text("glucose (mg/dL)");

    // target range label
    svg.append("text")
        .attr("transform", "translate(750,393) rotate(-90)")
        .attr("id", "targetrange") // use to style in stylesheet
        .text("TARGET RANGE");


    var focus = svg.append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var insulin_g = svg.append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    x.domain(d3.extent(bg, function (d) { return d[0]; }));
    y.domain([0, 400]);


    insulin_g.append("path")
      .datum(insulin_curve)
      .attr("fill", "#41948E")
      .attr("fill-opacity","0.5")
      .attr("stroke", "#41948E") // insulin curve color
      .attr("stroke-width", 5) // size(stroke) of the insulin curve
      .attr("d", d3.line()
        .x(function(d) { return x(d[0]) })
        .y(function(d) { return y(d[1]) })
        )


    // meal vertical line
    svg.append('line')
        .style("stroke", "#C4c4c4") // color of meal line
        .style("stroke-dasharray", ("3, 5"))
        .style("stroke-width", 2)
        .attr("x1", 333)
        .attr("y1", 20)
        .attr("x2", 333)
        .attr("y2", 500);

    // Meal point
    svg.append("circle")
        .attr("cx", 333)
        .attr("cy", 495)
        .attr("r", 5)
        .style("fill", "black");

    // Meal text
    svg.append("text")
        .attr("transform", "translate(317,480)")
        .attr("class", "range") // use to style in stylesheet
        .text("Meal");

    focus.selectAll('circle')
        .data(bg)
        .enter()
        .append('circle')
        .attr('r', 3.0)
        .attr('cx', function (d) { return x(d[0]); })
        .attr('cy', function (d) { return y(d[1]); })
        .style('cursor', 'pointer')
        .style('fill', '#000000'); // glucose curve color

    focus.selectAll('circle')
        .call(drag);

    focus.append('g')
        .attr('class', 'axis axis--x')
        .attr('transform', 'translate(0,' + height + ')')
        .call(xAxis);

    focus.append('g')
        .attr('class', 'axis axis--y')
        .call(yAxis);

    function dragstarted(d) {
        d3.select(this).raise().classed('active', true);
    }

    function dragged(d) {
        d[0] = x.invert(d3.event.x);
        d[1] = y.invert(d3.event.y);
        d3.select(this)
            // how would I modify the points around this one?
            .attr('cy', y(d[1]))
        //  focus.select('path').attr('d', line);
    }

    function dragended(d) {
        d3.select(this).classed('active', false);
    }

    function update_bg(data) {
        focus.selectAll('circle')
            .data(data)
            // .transition()
            // .duration(500)
            .attr('cx', function (d) { return x(d[0]); })
            .attr('cy', function (d) { return y(d[1]); })
            ;
    }

    function update_insulin(data) {
        insulin_g.selectAll("path")
            .datum(data)
            // .transition()
            // .duration(500)
            .attr("d", d3.line()
                .x(function (d) { return x(d[0]) })
                .y(function (d) { return y(d[1]) })
            )
    }

    function time_in_range(bg_data){
      var inrange = 0;
      for (i = 0; i < bg_data.length; i++){
          if (bg_data[i][1]>69 && bg_data[i][1]<181){
              inrange++;
          }
      }
      var timeinrange = Math.round(inrange / bg_data.length * 100);
      document.getElementById("timeNum").innerHTML = timeinrange + "%";
    }

    function goingLow_Or_High(bg_data){
      low = 0
      high = 0
      for (i=0; i < bg_data.length-1; i++){
        if (bg_data[i][1]<70 && bg_data[i+1][1]<70){
          low++;
        }
        if (bg_data[i][1]>180 && bg_data[i+1][1]>180){
          high++;
        }
      }
      if (low > 0 && high > 0){
          $("#above_below").show();
          $("#above180").hide();
          $("#below70").hide();
          return;
      }
      if (low > 0) {
        $("#below70").show();
        $("#above180").hide();
        $("#above_below").hide();
        return;
      }
      if (high > 0) {
        $("#above180").show();
        $("#above_below").hide();
        $("#below70").hide();
        return;
      }
      $("#above180").hide();
      $("#below70").hide();
      $("#above_below").hide();
    }


    function selected_time(bolus_time){
      var hours = bolus_time.getHours(); // gives the value in 24 hours format
      var AmOrPm = hours >= 12 ? 'PM' : 'AM';
      hours = (hours % 12) || 12;
      var minutes = bolus_time.getMinutes() > 9 ? bolus_time.getMinutes() : '0' + bolus_time.getMinutes();
      var finalTime = "Time (hr): " + hours + ":" + minutes + " " + AmOrPm;
      document.getElementById("selectedTime").innerHTML = finalTime;
    }

    function time_from_meal(bolus_time){
      var bt_min = (bolus_time.getHours()*60) + bolus_time.getMinutes();
      var mt_min = 17*60;
      var difference = bt_min - mt_min;
      if (difference > 0){
        document.getElementById("bolus_meal_time").innerHTML = difference + " min after meal";
      }
      else if (difference <= 0){
        document.getElementById("bolus_meal_time").innerHTML = Math.abs(difference) + " min before meal";
      }
      pos = (difference*4.5) + 370;
      if(pos >= 0){
        document.getElementById("bolus_meal_time").style.paddingLeft = pos + "px";
      }
      if (pos < 0){
        document.getElementById("bolus_meal_time").style.paddingRight = Math.abs(pos) + "px";
      }
    }

    var b_t = default_bolus_time;

    // bolus point
    d3.select("circle")
       .attr("cx", 225)
       .attr("cy", 475)
       .attr("r", 5)
       .style("fill", "black");

    // bolus text
    d3.select("text")
        .attr("x", 245)
        .attr("y", 480)
        .attr("class", "range") // use to style in stylesheet
        .text("Bolus");

    // bolus vertical line
    d3.select('line')
         .style("stroke", "#C4c4c4") // color of meal line
         .style("stroke-dasharray", ("3, 5"))
         .style("stroke-width", 2)
         .attr("x1", 274)
         .attr("y1", 20)
         .attr("x2", 274)
         .attr("y2", 500);


    d3.select("#bolus_time").on("input", function (d) {
        selectedValue = parseInt(this.value, 10);
        selectVal = selectedValue // use for bolus pin

        var bolus_time=d3.timeMinute.offset(default_bolus_time, selectedValue);

        selected_time(bolus_time) // update selected time in the html
        time_from_meal(bolus_time)

        b_t = bolus_time;
        var insulin = calculate_insulin_curve(bolus_time);
        update_insulin(insulin);
        var bg_data=apply_insulin(insulin);
        update_bg(bg_data);

        time_in_range(bg_data); // update time in range
        goingLow_Or_High(bg_data);

        // bolus point
        d3.select("circle")
           .attr("cx", selectedValue*0.95+225)
           .attr("cy", 475)
           .attr("r", 5)
           .style("fill", "black");

        // bolus text
        d3.select("text")
            .attr("x", selectedValue*0.95+245)
            .attr("y", 480)
            .attr("class", "range") // use to style in stylesheet
            .text("Bolus");

        //bolus vertical line
        d3.select('line')
             .style("stroke", "#C4c4c4") // color of meal line
             .style("stroke-dasharray", ("3, 5"))
             .style("stroke-width", 2)
             .attr("x1", selectedValue*0.95+274)
             .attr("y1", 20)
             .attr("x2", selectedValue*0.95+274)
             .attr("y2", 500);

    });


    // function to add shadow to the navbar
    $(window).scroll(function() {
    var scroll = $(window).scrollTop();
    if (scroll > 0) {
      $("#header").addClass("active");
    }
    else {
      $("#header").removeClass("active");
    }
    });

    // tooltips
    $(function () {$('[data-toggle="tooltip"]').tooltip()})

    $("#targetrange").hover(function(){$("#target").show();});
    $("#targetrange").mouseleave(function(){$("#target").hide();});

    // open beginning modal
    $(document).ready(function () {
      $('#intro').modal({backdrop: 'static', keyboard: false})
      $('#intro').modal('show');
    });

    $('#intro').on('show.bs.modal', function (e) {
        $('body').addClass("example-open");
    }).on('hide.bs.modal', function (e) {
        $('body').removeClass("example-open");
    })

    $('#scenario').on('show.bs.modal', function (e) {
        $('body').addClass("example-open");
    }).on('hide.bs.modal', function (e) {
        $('body').removeClass("example-open");
    })

    $('#back').on('click', function() { window.location = 'graphs-menu.html'; });
    $('#reset').on('click', function() { window.location = 'bolus_too_early.html'; });
    $('#next').on('click', function() { $('#intro').modal('hide'); });
    // $('#next').on('click', function() {
    //   $('#intro').modal('hide');
    //   $('#scenario').modal({backdrop: 'static', keyboard: false})
    //   $('#scenario').modal('show'); });
</script>
</html>
