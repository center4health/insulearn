<!DOCTYPE html>
<html lang="en">

<head>
  <title>Visual Diabetes Learning</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="https://kit.fontawesome.com/008a24505e.js" crossorigin="anonymous"></script>
</head>
<style>
  #learn {
    color: black;
    background-color: white;
    border-color: #c4c4c4;
  }

  #learn:hover {
    color: black;
    background-color: #ededed;
    /*dark green*/
    border-color: #ededed;
    /*dark green*/
  }

  .footer {
    position: fixed;
    padding-top: 25px;
    padding-bottom: 25px;
    left: 0;
    bottom: 0;
    width: 100%;
    background-color: #41948E;
    /*emerald green*/
    color: white;
    text-align: center;
  }
</style>

<body>
  <div id="overlay"></div>

  <!--Fixed Navigation Bar-->
  <nav class="navbar navbar-default navbar-fixed-top" id="header">
    <div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
          data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#"><b>Diabetes Learning</b></a>
      </div>

      <!-- Links to home, interactive graphs, terminology, and about -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav navbar-right">
          <li class="active"><a href="#">Home</a></li>
          <li><a href="graphs-menu.html">Learning Tools</a></li>
          <li><a href="terminology.html">Glosssary</a></li>
          <li><a href="about.html">About</a></li>
        </ul>
      </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
  </nav>

  <!-- The side menu that is invisible at first-->
  <div id="mySidenav" class="sidenav">
    <a href="javascript:void(0)" id="close" onclick="closeNav()"><i class="fas fa-times"></i></a>
    <a href="javascript:void(0)" id="grid"><i class="fas fa-th-large"></i></a>

    <!-- The text at the top of the sidebar -->
    <div class="container">
      <h1>
        Welcome to Learn Diabetes!
      </h1>
      <p>Here, you will learn the basics of diabetes.</br> Select a topic below.</p>
    </div>
    <div class="container-fluid" id="topics">
      <div id="carbs">
        <div class="col-md-12">
          <h1>Topic 1: Simple Carbohydrates (carbs)</h1>
        </div>


        <div class="row">
          <div class="col-md-1">
            <img src="img/left.png" class="hidden" id="previous">
          </div>

          <div class="col-md-4">
            <button class="scenario" onclick="{ window.location = 'carbcontent.html'; }"><img src="img/carbcontent.png">
              <p>Simple Carbs</p>
            </button>
          </div>

          <div class="col-md-4">
            <button class="scenario" onclick="{ window.location = 'carbamount.html'; }"><img src="img/carbamount.png">
              <p>Carb Counting</p>
            </button>
          </div>
          <div class="col-md-1">
            <img src="img/right.png" class="align-middle" id="next">
          </div>
        </div>
      </div>
      <div id="insulin" class="hidden">
        <div class="row">
          <div class="col-md-12">
            <h1>Topic 2: Bolus</h1>
          </div>

          <div class="col-md-1">
            <img src="img/left.png" id="previous2">
          </div>
          <div class="col-md-3">
            <button class="scenario" onclick="{ window.location = 'bolus_too_early.html'; }"><img
                src="img/bolustime.png">
              <p>Insulin Timing</p>
            </button>
          </div>
          <div class="col-md-3">
            <button class="scenario" onclick="{ window.location = 'bolus_too_little.html'; }"><img
                src="img/bolusdose.png">
              <p>Insulin Dosing</p>
            </button>
          </div>
          <div class="col-md-3">
            <button class="scenario" onclick="{ window.location = 'prebolus.html'; }"><img
                src="img/bolustime&dose.png">
              <p>Insulin Timing and Dosing</p>
            </button>
          </div>
          <div class="col-md-1">
            <img src="img/right.png" class="hidden" id="next2">
          </div>
        </div>
      </div>
    </div>

  </div>

  <div id="handle" onclick="openNav()">
    <i class="fas fa-bars"></i>
  </div>

  <div id="next_topic" onclick="{ window.location = 'bolus_too_little.html'; }">
    <p>Next Topic:</br>Insulin Dosing</p>
  </div>

  <div id="previous_topic" onclick="{ window.location = 'carbamount.html'; }">
    <p>Previous Topic:</br>Carb Count</p>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-md-9">
        <div id="chart">

        </div>

      </div>

      <div class="col-md-3">
        <div id="info">
          <h1>Insulin Timing</h1>
          <div id="infodetails">
            <p>You pre-bolused for your meal, but received an important call before you started eating.
              You ended up eating an hour after you pre-bolused.
            </p>
            <p><b>Adjust the bolus time</b> to increase the time in range.</p>
          </div>
        </div>
      </div>

    </div>
    <div class="row">
      <!-- TIME SLIDER-->
      <div class="col-sm-2">
        <p id="selectedTime">Time (hr): 12:30 PM</p>
      </div>
      <div class="col-sm-10">
        <p id="bolus_meal_time">60 min before meal</p>
        <input type="range" name="bolus_time" id=bolus_time min="-30" max="300" value="0" style="width: 600px"></input>
      </div>
    </div>
  </div>



</body>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="dwn.js"></script>
<script>
  // function to add shadow to the navbar
  $(window).scroll(function () {
    var scroll = $(window).scrollTop();
    if (scroll > 0) {
      $("#header").addClass("active");
    }
    else {
      $("#header").removeClass("active");
    }
  });

  //function for side bar
  function openNav() {
    document.getElementById("overlay").style.display = "block";
    document.getElementById("mySidenav").style.width = "80%";
  }

  function closeNav() {
    document.getElementById("overlay").style.display = "none";
    document.getElementById("mySidenav").style.width = "0";
  }

  $(document).ready(function () {
    $("#next").click(function () {
      $("#carbs").addClass("hidden");
      $("#insulin").removeClass("hidden");
    });
    $("#previous2").click(function () {
      $("#carbs").removeClass("hidden");
      $("#insulin").addClass("hidden");
    });


  });
  let timeParse = d3.timeParse("%H:%M")
  let timeFormat = d3.timeFormat("%I:%M%p")
  let mintime = timeParse("12:00");
  let model = new Model(mintime, timeParse("20:00"));
  let chart = new Chart("#chart", model, 300);


  function updateView() {
    tbr = model.getTimeBelowRange();
    tar = model.getTimeAboveRange();
    tir = model.getPercentTimeInRange();
    if (tar > 0) {
      chart.updateToolTip(`Warning ${tar}% above Range`, "#E49C9D", "Try to adjust the bolus timing", "Use the slider below");
    } else {
      if (tbr > 0) {
        chart.updateToolTip(`Danger ${tbr}% Time below Range`, "#9CD9B5", "Try to adjust the bolus timing", "Use the slider below");
      } else {
        chart.updateToolTip("Good Job! 100% Time in Range", "#9CD9B5", "Can you get even better?", "Or go on to the next topic");
      }
    }

    let bolus_time = insulin.getTime();
    document.getElementById("selectedTime").innerHTML = `Bolus Time ${timeFormat(bolus_time)}`

    let diff = (bolus_time - hiddenmeal.getTime()) / (60 * 1000);
    let message = "Bolus exactly at meal time";
    if (diff < 0) {
      message = `Bolus ${-diff} min before meal`;
    }
    if (diff > 0) {
      message = `Bolus ${diff} min after meal`;
    }
    document.getElementById("bolus_meal_time").innerHTML = message;

  }


  chart.drawTargetRange([70, 180]);
  let hiddenmeal = new Meal(90, timeParse("13:30"), MEAL_COMPONENTS.SIMPLE_CARB, "Meal");
// hiddenmeal.displayoptions.hidden = true;
  hiddenmeal.displayoptions.yhandle = false;
  hiddenmeal.displayoptions.xhandle = false;
  hiddenmeal.displayoptions.name = true;

  let insulin = new Insulin(30, timeParse("12:30"), INSULIN_TYPE.RAPID, "Bolus");
  insulin.displayoptions.yhandle = false;
  insulin.displayoptions.xhandle = false;
  insulin.displayoptions.name = true;
  insulin.onTimeChange(updateView)

  model.addFactor(hiddenmeal);
  model.addFactor(insulin);

  chart.drawMeal(hiddenmeal)
  chart.drawInsulin(insulin);
  chart.drawBG(model);
  updateView();





  $('#learn').on('click', function () { window.location = 'terminology.html'; });
  $('#seeworks').on('click', function () { openNav(); });
  $("#bolus_time").on("input", function (d) {
    minute = this.value
    insulin.changeTimeByMinute(minute);
  });
</script>

</html>